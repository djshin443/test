// JPG 저장 함수 (흰색 여백 완전 제거)
        async function saveAsJPG(orientation) {
            closeSaveModal();
            
            const element = document.getElementById('timetable-wrapper');
            const today = new Date();
            const filename = `나의_시간표_${orientation === 'landscape' ? '가로' : '세로'}_${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, '0')}${String(today.getDate()).padStart(2, '0')}`;
            
            showLoadingOverlay(`${orientation === 'landscape' ? '가로' : '세로'} A4 JPG 생성 중...`);
            
            try {
                const controls = document.querySelector('.controls');
                const originalContainer = document.getElementById('timetable-container');
                
                // 배경 이미지 정보 미리 추출
                const hasBackgroundImage = originalContainer.classList.contains('has-bg');
                const backgroundImageUrl = originalContainer.style.backgroundImage;
                
                // 원본 스타일 저장
                const originalStyles = {
                    controlsDisplay: controls ? controls.style.display : '',
                    containerBackground: originalContainer.style.background
                };
                
                // 컨트롤 숨기기
                if (controls) controls.style.display = 'none';
                
                // A4 크기 설정
                const A4_SIZES = {
                    landscape: { width: 1123, height: 794 },
                    portrait: { width: 794, height: 1123 }
                };
                
                const targetSize = A4_SIZES[orientation];
                
                // 렌더링 대기
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // html2canvas로 캡처 - 배경 이미지가 있으면 포함해서 캡처
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff', // 흰색 배경
                    width: targetSize.width,
                    height: targetSize.height,
                    windowWidth: targetSize.width,
                    windowHeight: targetSize.height,
                    scrollY: 0,
                    scrollX: 0,
                    x: 0,
                    y: 0,
                    letterRendering: true,
                    allowTaint: true,
                    foreignObjectRendering: false,
                    removeContainer: false,
                    imageTimeout: 30000
                });
                
                // 최종 캔버스 생성
                const finalCanvas = document.createElement('canvas');
                finalCanvas.width = canvas.width;
                finalCanvas.height = canvas.height;
                const finalCtx = finalCanvas.getContext('2d');
                
                // 배경 이미지가 있는 경우 처리
                if (hasBackgroundImage && backgroundImageUrl && backgroundImageUrl !== 'none') {
                    const bgImg = new Image();
                    bgImg.crossOrigin = 'anonymous';
                    
                    await new Promise((resolve, reject) => {
                        bgImg.onload = function() {
                            // 배경 이미지를 cover 방식으로 그리기
                            const canvasAspect = finalCanvas.width / finalCanvas.height;
                            const imgAspect = bgImg.width / bgImg.height;
                            
                            let drawWidth, drawHeight, drawX, drawY;
                            
                            if (imgAspect > canvasAspect) {
                                drawHeight = finalCanvas.height;
                                drawWidth = drawHeight * imgAspect;
                                drawX = (finalCanvas.width - drawWidth) / 2;
                                drawY = 0;
                            } else {
                                drawWidth = finalCanvas.width;
                                drawHeight = drawWidth / imgAspect;
                                drawX = 0;
                                drawY = (finalCanvas.height - drawHeight) / 2;
                            }
                            
                            // 배경 이미지 그리기
                            finalCtx.drawImage(bgImg, drawX, drawY, drawWidth, drawHeight);
                            
                            // 반투명 흰색 오버레이
                            finalCtx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                            finalCtx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
                            
                            resolve();
                        };
                        
                        bgImg.onerror = () => {
                            // 배경 이미지 로드 실패 시 흰색 배경
                            finalCtx.fillStyle = '#ffffff';
                            finalCtx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
                            resolve();
                        };
                        
                        // base64 URL에서 이미지 로드
                        if (backgroundImageUrl.includes('url(')) {
                            const urlMatch = backgroundImageUrl.match(/url\(["']?(data:image[^"']+)["']?\)/);
                            if (urlMatch) {
                                bgImg.src = urlMatch[1];
                            } else {
                                bgImg.src = backgroundImageUrl.replace(/url\(["']?([^"']+)["']?\)/, '$1');
                            }
                        }
                    });
                } else {
                    // 배경 이미지가 없는 경우 그라데이션 배경
                    const gradient = finalCtx.createLinearGradient(0, 0, finalCanvas.width, finalCanvas.height);
                    gradient.addColorStop(0, '#ffccf2');
                    gradient.addColorStop(0.5, '#e6ccff');
                    gradient.addColorStop(1, '#ccddff');
                    finalCtx.fillStyle = gradient;
                    finalCtx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
                }
                
                // 시간표 콘텐츠를 그 위에 그리기
                finalCtx.drawImage(canvas, 0, 0);
                
                // JPG 다운로드
                const link = document.createElement('a');
                link.download = `${filename}.jpg`;
                link.href = finalCanvas.toDataURL('image/jpeg', 0.95);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // 모든 스타일 복원
                if (controls) controls.style.display = originalStyles.controlsDisplay;
                originalContainer.style.background = originalStyles.containerBackground;
                
                hideLoadingOverlay();
                
                console.log(`${orientation} JPG 저장 완료:`, filename);
                
            } catch (error) {
                console.error('JPG 생성 오류:', error);
                hideLoadingOverlay();
                alert('이미지 저장 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');
            }
        }